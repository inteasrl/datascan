import{c$ as p,d0 as $,d1 as y,cK as T,cL as u,cH as c,d2 as Z,d3 as w,d4 as C,cQ as S,d5 as d}from"./dati-PMIs3YEJ.js";const v=",",U={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},D=new Set(["integer","small-integer"]);let l=null;function F(e){return p(e)||$(e)||y(e)}async function M(e){const{field:n,field2:t,field3:r,normalizationField:i,valueExpression:a}=e;let o=[];if(a){if(!l){const{arcadeUtils:s}=await S();l=s}o=l.extractFieldNames(a)}return n&&o.push(n),t&&o.push(t),r&&o.push(r),i&&o.push(i),o}function f(e){return String(e).padStart(2,"0")}function g(e,n,t){let r;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),r=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${f((t?e.getMonth():e.getUTCMonth())+1)}-${f(t?e.getDate():e.getUTCDate())} ${f(t?e.getHours():e.getUTCHours())}:${f(t?e.getMinutes():e.getUTCMinutes())}:${f(t?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function b(e,n,t,r){const{hasQueryEngine:i}=e,a=`(${g(t,h(e,t),i)} - ${g(n,h(e,n),i)})`;let o=U[r],s="/";return o<1&&(o=1/o,s="*"),{sqlExpression:o===1?a:`(${a} ${s} ${o})`,sqlWhere:null}}function h(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const t=e.getField(n);if(n.toLowerCase()==="<now>")return;if(p(t))return"field"}}function x(e,n){const t=n&&e.getField(n);return!!t&&D.has(t.type)}function E(e){return`cast(${e} as float)`}function I(e,n){const{format:t,timeZoneOptions:r,fieldType:i}=n??{};let a,o;if(r&&({timeZone:a,timeZoneName:o}=T(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,u(t||"short-date-short-time"),i)),typeof e=="string"&&isNaN(Date.parse(i==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(i){case"date-only":{const s=u(t||"short-date");return typeof e=="string"?C(e,{...s}):c(e,{...s,timeZone:d})}case"time-only":{const s=u(t||"short-time");return typeof e=="string"?w(e,s):c(e,{...s,timeZone:d})}case"timestamp-offset":{if(!a&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;const s=t||r?u(t||"short-date-short-time"):void 0,m=s?{...s,timeZone:a,timeZoneName:o}:void 0;return typeof e=="string"?Z(e,m):c(e,m)}default:{const s=t||r?u(t||"short-date-short-time"):void 0;return c(typeof e=="string"?new Date(e):e,s?{...s,timeZone:a,timeZoneName:o}:void 0)}}}export{F as $,b as C,E as M,I as N,M as U,v as f,x as j};
